# 多言語文字列表示(DisplayI18NTexts.json)

## バージョン
### 最新バージョン（ダウンロード）
[1.0.3](https://raw.githubusercontent.com/nz-prism/RPG-Maker-MZ/master/I18NTexts/js/plugins/DisplayI18NTexts.js)

### バージョン履歴
- 2023/06/04 1.0.0 リリース
- 2023/06/04 1.0.1 ロケール名を修正 (ja-JP=>ja_JP, en-US=>en_US, ru-RU=>ru_RU)
- 2023/10/02 1.0.2 言語オプションで左にカーソルを動かすと発生するエラーを修正
- 2023/10/04 1.0.3 OptionEx v1.5.0に合わせて修正

## 概要
オプションで設定されている言語に応じて、専用制御文字を変換して表示します。
本プラグインは[**オプション拡張**（**OptionEx.js**）](https://github.com/nz-prism/RPG-Maker-MZ/tree/master/OptionEx)プラグインの導入が前提となります。**OptionEx**よりも後に配置してください。

以下の二つの機能が用意されています。
1. 言語オプションを追加
1. 専用制御文字を、現在の言語に応じてJSONファイルから取得した文字列に置き換えて表示

**1**はオプション画面に**言語**オプションを追加する機能です。言語オプションでは、プラグインパラメータ**使用言語**に設定した言語から選択できます。このパラメータの一番上に設定した言語がデフォルト言語になります。このパラメータに設定されている言語が一つしかない場合、言語オプションは表示されなくなります。

![Option](https://github.com/nz-prism/RPG-Maker-MZ/blob/master/ReadmeImages/DisplayI18NTexts1.png)

**2**は専用制御文字「\I18N[n]」を**I18NTexts.json**から取得した文字列に置き換えて表示する機能です。アクターの名前やプロフィール、アイテムの名前や説明といったデータベースのテキストやイベント中の文章など、ゲーム中に使用される文字列中に「\I18N[n]」が含まれていれば、それを変換して表示します。専用のJSONファイル**I18NTexts.json**中の**id**が制御文字中の**n**と一致するデータを参照します。このJSONファイルは別プラグイン**ConvertI18NTexts.js**によって生成されます。詳細は**ConvertI18NTexts.js**の説明をご覧ください。  
なお**I18NTexts.json**が**data**フォルダに存在しない場合、本プラグインはエラーになりますのでご注意ください。

![EscapeCharacter](https://github.com/nz-prism/RPG-Maker-MZ/blob/master/ReadmeImages/DisplayI18NTexts2.png)
![Japanese](https://github.com/nz-prism/RPG-Maker-MZ/blob/master/ReadmeImages/DisplayI18NTexts3.png)
![English](https://github.com/nz-prism/RPG-Maker-MZ/blob/master/ReadmeImages/DisplayI18NTexts4.png)

## ライセンス
このプラグインは**MITライセンス**にてリリースされています。  
https://opensource.org/licenses/mit-license.php

## 使用方法
導入方法は通常のプラグインと同様ですが、**OptionEx.js**の導入が前提になります。  
**js/plugins**フォルダに**DisplayI18NTexts.js**をコピーし、プラグイン管理にて有効化してください。
その他の詳細はプラグイン説明（プラグインパラメータ）をご覧ください。  

***

# 多言語文字列変換(ConvertI18NTexts.json)

## バージョン
### 最新バージョン（ダウンロード）
[1.2.0](https://raw.githubusercontent.com/nz-prism/RPG-Maker-MZ/master/I18NTexts/js/plugins/ConvertI18NTexts.js)

### バージョン履歴
- 2023/06/04 1.0.0 リリース
- 2023/06/04 1.0.1 ロケール名を修正 (ja-JP=>ja_JP, en-US=>en_US, ru-RU=>ru_RU)
- 2023/06/05 1.1.0 二重変換防止機能を追加
- 2024/10/10 1.2.0 変換対象を制御する２つのパラメータを追加

## 概要
ゲーム中に使用されるあらゆる文字列を専用制御文字に変換し、元の文字列をJSONファイルとして出力します。本プラグインはデータベースの文字列を直接変更します。**ご使用前に必ずバックアップをお取りください。本プラグインを使用したことで生じたあらゆる不具合や損失について、作者は一切責任を負いません。**

本プラグインを有効にした状態でテストプレイを起動すると文字列自動変換が始まり、完了するとそのままテストプレイが終了します。その後ツクールで「プロジェクトデータが外部で変更されました」というダイアログが表示されたら「はい」を選択してください（「いいえ」を選択した場合はツクールを再起動してください）。  

![Dialog](https://github.com/nz-prism/RPG-Maker-MZ/blob/master/ReadmeImages/ConvertI18NTexts1.png)

これによって文字列の変更がツクールに反映されます。実際に文字列を変換するとき以外は本プラグインを無効にしてください。なお有効にしたままデプロイメントしてしまったとしても、本プラグインはテストプレイ時にしか機能しませんので問題ありません。  
変換が完了するとデータベースやイベントのあらゆる変換対象文字列が、対応する文字列に変換されます。また初回起動時、**I18NTexts.json**ファイルが**data**フォルダ内に生成されます。二回目以降の起動の場合、同ファイルが更新されます。このファイルには変換前、データベースに入力されていた全ての文字列が出力されます。別プラグインである**DisplayI18NTexts.js**を使用することで、オプションで選択されている言語に応じた文字列を表示することが可能です。  
![Database](https://github.com/nz-prism/RPG-Maker-MZ/blob/master/ReadmeImages/ConvertI18NTexts2.png)  
![Folder](https://github.com/nz-prism/RPG-Maker-MZ/blob/master/ReadmeImages/ConvertI18NTexts3.png)  

起動前に必ず以下のプラグインパラメータの設定を確認してください。  
- **ソース言語**には、現在データベースに実際に入力されているテキストの言語（例：**日本語**）を指定します。これは変換完了後、JSONファイルに書き込まれる文字列の言語の指定になります。  
- **ターゲット言語**には、置換先言語を指定します。初回起動時は必ず**制御文字**を選択してください。データベース等の文字列は変換完了後、ここで選択した言語に対応する文字列に置き換わります。**制御文字**の場合は専用の数字が割り振られた制御文字「\I18N[n]」に置換されます。それ以外の言語の場合、**I18NTexts.json**にターゲット言語が含まれていれば対応する文字列に置き換わります。含まれていない場合、新しくその言語のデータ枠が用意されます。  
- **翻訳候補言語リスト**には、現在使用されている言語も含めて翻訳を検討している全ての言語を指定してください。初回起動時、ここで設定した全ての言語が**I18NTexts.json**のキーとして設定されます。ソース言語以外の言語の値には「temp[n]」という仮文字列が入力されます。  
![JSON](https://github.com/nz-prism/RPG-Maker-MZ/blob/master/ReadmeImages/ConvertI18NTexts4.png)  
（スクリーンショットは見やすいように整形しています）  
- ゲームタイトルも変換対象にしたい場合、**ゲームタイトルの変換**を**オン**にしてください。ただしタイトルバーに表示されるタイトルは翻訳されないので、このパラメータを**オン**にすることは推奨されません。  
- **未使用文字列の変換**を**オン**にすると、敵グループの名前やアニメーションの名前、イベントの名前といったツクール標準ではゲーム中表示されることのない文字列（メモ・注釈以外）も変換対象になります。  
- **メモの変換**を**オン**にすると、データベースの各種**メモ**およびイベントの**注釈**も変換対象になります。  
- **空行の変換**をオンにすると、メッセージ系イベントの空行も変換対象になります。言語によって適切な行数が異なるため、空行で行数を増やす場合などに使用してください。空行が変換対象だった前バージョンに合わせるため、デフォルトはオンになっています。
- **全制御文字テキストの変換**をオンにすると、制御文字のみで構成されたテキストも変換対象になります。このようなテキストが翻訳不要である場合はオフにしてください。このようなテキストが変換対象だった前バージョンに合わせるため、デフォルトはオンになっています。
- **プラグインパラメータ**にプラグイン名およびそのプラグインのプラグインパラメータ名を指定することで、プラグインパラメータに入力されている文字列も変換対象になります。ただし変換できるのは通常の文字列（**string**）のみであり、文字列のリスト（**string[]**）や構造体（**struct**）の中の文字列は変換できませんのでご注意ください。なお**DisplayI18NTexts.js**の前提プラグインである**OptionEx**の各種オプション項目名のプラグインパラメータ名は、あらかじめ指定されています。  
![PluginParameters](https://github.com/nz-prism/RPG-Maker-MZ/blob/master/ReadmeImages/ConvertI18NTexts5.png)  

変換が完了すると、本プラグインは自動的に無効化されます。また、**ソース言語**と**ターゲット言語**が入れ替わります。誤って本プラグインを二重に実行するとデータベースやJSONファイルがおかしくなってしまうため、これを防ぐために用意された機能です。

本プラグインを一度実行した後、次回以降の起動では**変換対象文字列**以下のパラメータを変更しないでください。また、データベース項目やイベント（イベント中のイベントコマンドも含む）を追加することは問題ありませんが、削除したり順番を変更したりしないでください。IDがずれて正常に変換できなくなってしまいます。なお空の文字列は変換対象になりません。元は空文字列だったデータに文字列を入力する、あるいはその反対の編集を行うとやはりIDがずれてしまいます。そうした変更を加える必要がある場合は、**data**フォルダ内の**I18NTexts.json**を削除してください。これにより初期化されます。

本プラグインは以下の手順にて使用することを推奨します（ゲーム中の文字列として日本語と英語の2ヶ国語を使用する場合の例です）。
1. プロジェクトフォルダのバックアップを取る
1. プラグインパラメータ**翻訳候補言語リスト**に**日本語**と**英語**を指定する
1. プラグインパラメータ**ソース言語**に**日本語**を選択する
1. プラグインパラメータ**ターゲット言語**に**制御文字**を選択する
1. **変換対象文字列**以下のプラグインパラメータ設定をよく確認する
1. **ConvertI18NTexts.js**を有効にする
1. テストプレイを実行する
1. 全ての変換対象の文字列が制御文字に変換されていることを確認する
1. **data**フォルダ内に**I18NTexts.json**が生成されていることを確認する
1. **I18NTexts.json**を開き、**ja_JP**というキーの値にツクール上に入力されていた文字列が、**en_US**というキーの値に「temp[n]」という仮文字列が設定されていることを確認する
1. **ConvertI18NTexts.js**を無効にする
1. **DisplayI18NTexts.js**のプラグインパラメータ**使用言語**に**日本語**と**英語**を指定する
1. **DisplayI18NTexts.js**を有効にする
1. **I18NTexts.json**内の任意のデータの**en_US**キーの値に、**ja_JP**キーの値の文字列を翻訳した文字列を入力する（オプション画面にて表示される文字列推奨）  
![Translation](https://github.com/nz-prism/RPG-Maker-MZ/blob/master/ReadmeImages/ConvertI18NTexts6.png)  
1. テストプレイを実行し、オプション画面を開く
1. **言語**にて日本語と英語を切り替え、**14**で入力した文字列が正常に翻訳されていることを確認する
1. 全ての文字列の翻訳が完了するまで**14**〜**16**を繰り返す

仮文字列（temp[n]）は正式に翻訳するまでの間はそのままにしてください。
削除して空文字列にしてしまうと不具合が生じます。

なおデータベース等の文字列を制御文字から元の言語の文字列に戻すこともできます。その場合**ソース言語**に**制御文字**を、**ターゲット言語**に**制御文字**以外の言語を指定してテストプレイを実行してください。その後、データベースやイベントの文字列が正常に変換されていることを確認してください。  
また、**I18NTexts.json**の内容を更新することもできます。例えばデータベース文字列が**日本語**であるとします。データベース上で何らかの文字列に変更を加えたとしても、**I18NTexts.json**のそれに対応する文字列はまだ古いままです。**ソース言語**と**ターゲット言語**の両方に**日本語**を指定してテストプレイを実行すると、**I18NTexts.json**に変更が反映されます。

**I18NTexts.json**の言語別キー一覧  
日本語: **ja_JP**  
英語: **en_US**  
中国語（簡体字）: **zh_CN**  
中国語（繁体字）: **zh_TW**  
韓国語: **ko_KR**  
フランス語: **fr_FR**  
イタリア語: **it_IT**  
ドイツ語: **de_DE**  
スペイン語: **es_ES**  
ポルトガル語: **pt_BR**  
ロシア語: **ru_RU**  

## ライセンス
このプラグインは**MITライセンス**にてリリースされています。  
https://opensource.org/licenses/mit-license.php

## 使用方法
導入方法については、上記手順を参考にしてください。
**js/plugins**フォルダに**ConvertI18NTexts.js**をコピーし、上記手順に従って使用してください。  
その他の詳細はプラグイン説明をご覧ください。